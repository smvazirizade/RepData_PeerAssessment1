---
title: "Project1"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is code generated by smvazirizade for the course reproducible Reseasrch on coursera as a project

```{r 0, results="asis",echo=F }
#Cleaning the environment
rm(list = setdiff(ls(), lsf.str()))
#installing required palcahges
wants <- c("ggplot2","dplyr","plotly")
has   <- wants %in% rownames(installed.packages())
if(any(!has)) install.packages(wants[!has])
for (pkg in wants) {library(pkg, character.only = TRUE)}
#cleaning the console
clc <- function() cat(rep("\n", 50))
clc()
```



# 1. Code for reading in the dataset and/or processing the data
Loading and preprocessing the data
```{r 1}
activity <- read.csv("data/activity.csv")
activity$date <- as.Date(activity$date)
head(activity)
str(activity)
```


# 2. Histogram of the total number of steps taken each day  
First we draw the total number of steps per day as a barplot  
```{r 2}
total_day <- activity %>% group_by(date) %>%summarise(total_steps=sum(steps,na.rm=TRUE),na=mean(is.na(steps)))
head(total_day)
ggplot(data=total_day, aes(x=date, y=total_steps)  )  +   geom_bar(stat="identity") + 
  geom_hline(yintercept = median(total_day$total_steps), color="blue") + 
  geom_hline(yintercept = mean(total_day$total_steps)  , color="red") +
  annotate("text", x = as.Date(min(total_day$date)), y = median(total_day$total_steps)+500 ,label = "Median", color="blue") +
  annotate("text", x = as.Date(min(total_day$date)), y = mean(total_day$total_steps)+500 ,label = "Mean", color="red")   
```  

Then we draw the Histogram  

```{r}
 ggplot(data=total_day, aes(total_steps)  )  +  geom_histogram() + labs(x = "total steps per day") +
 geom_vline(xintercept = mean(total_day$total_steps), color="blue")  
```


# 3. Mean and median number of steps taken each day  
```{r 3}
mean_steps <- mean(total_day$total_steps,na.rm=TRUE)
median_steps <- median(total_day$total_steps,na.rm=TRUE)
```
Mean and median of the total number of the steps per day are  `r mean_steps` steps and `r median_steps` steps, respectively.  

# 4. Time series plot of the average number of steps taken  
```{r 4}
 daily_patterns <- activity %>% group_by(interval) %>% summarise(average=mean(steps,na.rm=TRUE)) 
 ggplot(data=daily_patterns, aes(x=interval, y=average)) + geom_line(stat = "identity")
```

# 5. The 5-minute interval that, on average, contains the maximum number of steps  
```{r 5}
max_numb_steps_interval <- max(daily_patterns$average)
```
The maximum number of steps is `r max_numb_steps_interval`.  

# 6. Code to describe and show a strategy for imputing missing data  
```{r 6}
na_number <- sum(is.na(activity$steps))
without_NAs <- numeric(nrow(activity))
for (i in 1:nrow(activity))
{
        if (is.na(activity[i,"steps"])==TRUE)
            {
                    without_NAs[i]<-filter(daily_patterns,interval==activity[i,"interval"]) %>% select(average)
            } 
        else
            {
                    without_NAs[i]<-activity[i,"steps"]
            }
                    
}
activity_without_NAs<-mutate(activity,steps_no_NAs=without_NAs)
head(activity_without_NAs)
```
The whole number of the missing values are `r na_number`. 

# 7. Histogram of the total number of steps taken each day after missing values are imputed  
 total_day_noNAs <- activity_without_NAs %>% mutate(steps_no_NAs=as.numeric(steps_no_NAs)) %>% group_by(date) %>% summarise(total_steps=sum(steps_no_NAs))
 ggplot(data=total_day_noNAs, aes(total_steps)  )  +  geom_histogram() + labs(x = "total steps per day") +
   geom_vline(xintercept = mean(total_day_noNAs$total_steps), color="blue")  
```

# 8. Panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends  
Create a new factor variable in the dataset with two levels - "weekday" and "weekend" indicating whether a given date is a weekday or weekend day.
```{r 8}
 activity_without_NAs <- mutate(activity_without_NAs, WeekDay= weekdays(date))  
 activity_without_NAs <- mutate(activity_without_NAs, WeekEnd= (activity_without_NAs$WeekDay=="Saturday" |  activity_without_NAs$WeekDay=="Sunday"))  
 total_day_noNAs_grouped <- activity_without_NAs  %>% group_by(interval,WeekEnd) %>% summarise(average=mean(as.numeric(steps_no_NAs)) )
 total_day_noNAs_grouped
 labels <- c('FALSE' = "Weekdays", 'TRUE' = "Weekend")
 ggplot(data=total_day_noNAs_grouped, aes(x=interval, y=average)) + geom_line(stat = "identity")+ facet_grid(WeekEnd~.~., labeller=labeller(WeekEnd = labels)) 
 
```




